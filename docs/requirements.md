## 熱見守りボット（電話×LINE）要件定義書 v1.0
- 作成日：2025-08-11（JST）
- 作成者：あなたの開発パートナー（GPT-5 Thinking）
- 対象：MVP～正式版の要件を網羅（自治会導入・家族直契約の両運用を想定）
- 用語略：本人＝対象高齢者、家族＝家族/キーパーソン、近隣＝近所協力者、管理者＝自治会/包括支援/運用担当

---

### 1. 背景・目的・目標
- 背景
  - 屋内熱中症の重症・死亡リスクが高齢者で顕著。従来の注意報は“届いても行動につながらない”。
  - スマホ非依存（固定電話中心）で“確実に届く”仕組みが不足。
- 目的
  - 暑熱警戒日に本人へ音声電話で行動喚起と安否確認を必ず届け、未応答時は家族/近隣へ自動エスカレーション。
  - 「誰が、いつ、何をしたか」を可視化し、地域/家族が即フォローできる体制を常態化。
- サービス目標（MVP指標）
  - 警戒日応答率 ≥ 85%
  - 未応答の当日フォロー完了率 ≥ 95%
  - エアコンON自己申告率（警戒日）+30%
  - インシデント検知→家族到達の中央値 ≤ 10分

---

### 2. スコープ
- インスコープ（MVP）
  1. 気象/暑さ指数の地域判定（町丁目～数百mメッシュ相当の粒度）
  2. 警戒時刻の自動発呼（IVR+DTMF）／SMSリマインド
  3. 家族・近隣・民生委員への段階的通知（LINE Bot中心）
  4. 管理画面：世帯台帳、当日アラート一覧、未応答残件、通話ログ、手動再コール
  5. 同意・個人情報の取得・保護、監査ログ、簡易レポート出力（CSV）
- 将来拡張（スコープ外/MVP後）
  - 自然言語対話IVR、地図ヒートマップ、多拠点（自治体横断）アカウント、医療・介護システム連携、マル言語音声、コールセンター座席連携等

---

### 3. ステークホルダー & ロール
- 本人（高齢者）：固定電話/携帯で着信・ボタン入力
- 家族/近隣：LINEで通知受領・応答記録・発信
- 管理者：名簿運用、当日オペレーション、エスカ対応、レポート出力
- 運営者：SLA/監視、障害対応、データ保護、契約・課金
- 権限ロール
  - R1: 管理者（自治会/包括）
  - R2: 家族/近隣（招待制）
  - R3: 運営者（システム管理）

---

### 4. ユースケース（要約）
- UC-01 本人に警戒発呼 → 「1:大丈夫 / 2:しんどい / 3:ヘルプ」入力
- UC-02 未応答 → SMS → 再コール → 家族LINE → 近隣LINE（段階）
- UC-03 家族がLINEから「今から連絡」「訪問手配」「問題なし」をワンタップ報告
- UC-04 管理者が未応答一覧を見て手動再コール／連絡記録
- UC-05 新規世帯登録・同意取得・連絡順序設定
- UC-06 日次レポート/CSV出力（応答率、エスカ回数、所要時間）

---

### 5. 機能要件（FR）
- FR-001 暑さ判定：住所→地域メッシュ化し、暑さ指数/警戒情報を1時間毎に取得・判定。
- FR-002 発呼スケジュール：警戒ON時、9:00 / 13:00 / 17:00に自動発呼（地域ごとに可変）。
- FR-003 IVRガイダンス：TTSまたは録音音声で案内。DTMFで1/2/3入力受理。再読・やり直し可。
- FR-004 応答記録：世帯・時刻・通話秒数・DTMF・結果を保存。
- FR-005 未応答ハンドリング：
  - 1回目未応答→SMS（折返し依頼）
  - 2回目未応答（5分後再コール）
  - 3段目→家族LINEに未応答通知＋アクションボタン
  - 4段目→近隣LINEに声かけ依頼（事前同意がある場合のみ）
- FR-006 インシデント：「2＝しんどい」「3＝ヘルプ」時、家族LINEに至急通知＋ワンタップ発信。
- FR-007 管理画面：当日アラート一覧、未応答フィルタ、“赤”強調、手動再コール、応答詳細。
- FR-008 世帯台帳：氏名、電話、住所（町丁目）、配慮事項、家族/近隣の連絡先と優先順位。
- FR-009 招待/紐付け：家族・近隣のLINEを招待リンクで紐付け。
- FR-010 ログ/監査：通知/発呼/既読/操作の監査ログ（不可改ざん性担保）。
- FR-011 同意管理：目的・範囲・第3者提供（家族/近隣通知）への同意を電子または紙で管理。
- FR-012 レポート：日/週/月の応答率、未応答件数、エスカ時間、インシデント件数をCSV出力。
- FR-013 多チャネル冗長：電話不可時→SMS/LINEで代替要請を送出。
- FR-014 通知テンプレ：地域/季節別の文言テンプレとA/B切替。
- FR-015 退会/削除：依頼に応じ即時停止、データ削除（法的保管分除く）。
- FR-016 多組織：1テナント＝1自治会（将来の多拠点前提で内部テナントID付与）。

---

### 6. ビジネスルール（BR）
- BR-001 警戒基準：WBGT（または相当指標）「警戒」以上で発火。夜間は原則発呼しない（22–7時は回避）。
- BR-002 通知頻度：警戒日最大3回、最初の有効応答で当日終了。
- BR-003 エスカ順序：家族→近隣→（任意）民生委員。家族が「対応済み」を押せば以降の段は停止。
- BR-004 プライオリティ：要配慮（独居/既往症）世帯は午前帯の発呼を優先。
- BR-005 リトライ：話中/圏外/不在は5分後に1回再コール。
- BR-006 メッセージ設計：具体的行動（エアコンON・水分・休息）を含め、恐怖訴求を避ける。
- BR-007 データ保持：個人情報は90日で自動マスキング（監査メタのみ12か月保持）。
- BR-008 緊急：「3：ヘルプ」は即時で家族発信ボタン提示＋管理者に赤バッジ表示。

---

### 7. 非機能要件（NFR）
- NFR-001 可用性：サービス稼働率 99.5%以上（盛夏期）。コア時間（7–20時）は 99.9%目標。
- NFR-002 スケーラビリティ：同時発呼ピーク 1000世帯/分（キュー制御）。
- NFR-003 性能：発呼キュー投入→実呼開始の平均遅延 ≤ 60秒。LINE通知遅延 ≤ 10秒（平均）。
- NFR-004 セキュリティ：転送TLS1.2+、保存AES-256、PII分離、最小権限、監査証跡、IP許可制（管理画面）。
- NFR-005 認証/認可：管理画面はOIDC/パスワードレス、RBAC（R1/R2/R3）。
- NFR-006 監視：外形監視（発呼試験番号）、ジョブ監視、APIレイテンシ、エラーレート。
- NFR-007 バックアップ：RPO 15分、RTO 2時間（DB/設定）。
- NFR-008 アクセシビリティ：音声はゆっくり/簡潔/再読。文字は高コントラスト（管理画面）。
- NFR-009 ログ保全：時刻同期・改ざん検知（WORM/ハッシュ鎖）。
- NFR-010 国際化：文字コードUTF-8、日本語前提。将来英/中対応のプレース設計。

---

### 8. データ要件・モデル（概要）
- 主テーブル
  - households（世帯）：id, name, phone, address_grid, notes, consent_at, risk_flag
  - contacts（連絡先）：id, household_id, type(family/neighbor/staff), line_user_id/phone, priority
  - alerts（当日警戒）：id, household_id, date, level, status(open/ok/escalated), first_trigger_at
  - call_logs：id, alert_id, started_at, duration, result(noanswer/busy/ok/help), dtmf
  - notifications：id, alert_id, channel(phone/sms/line), to, status, delivered_at
  - audit_logs：actor, action, target_id, detail, ts
- 保持・削除
  - PII 90日でマスキング。監査/集計は匿名化して12か月。
  - 退会は即時停止し、30日後に完全削除（法令保持分除く）。

---

### 9. 外部インタフェース
- 暑さ指標API：WBGT/気温・湿度の地域メッシュAPI（1時間間隔ポーリング）。タイムアウト3秒、再試行指数バックオフ。
- 音声/電話：発呼API、TTS/録音、DTMF収集、結果Webhook。
- SMS：送信API、配送レポートWebhook。
- LINE：Messaging API（Push/Reply）、友だち紐付け、クイックリプライ。
- 運用通知：Pager/Slack/Webhook（障害・遅延アラート）。

---

### 10. エラー処理・フォールバック
- 発呼失敗：別回線プロバイダのセカンダリキューへ自動フェイルオーバー（MVPは手動でも可）。
- APIダウン：直近観測値のキャッシュ（最大2時間）で判定継続。
- LINE不可：SMSリンクで代替（家族）。
- 大量障害：緊急バナーを管理画面に表示し、紙・電話網での手動運用手順を提示。

---

### 11. オペレーション/監視
- ダッシュボード：当日アラート、未応答、赤アラート、キュー遅延。
- アラート閾値：未応答率>15%（連続30分）/ 発呼遅延>60秒 / API失敗率>2%。
- 定期点検：試験番号への毎朝テストコール、LINE到達テスト。
- 変更管理：本番へのリリースはコア時間外に実施、ロールバック手順整備。

---

### 12. 法務・プライバシー（個人情報保護法準拠）
- 取得目的：熱中症予防の見守り連絡・家族/近隣への状況連絡。
- 第三者提供：家族/近隣・自治会への連絡に限定（明示同意必須）。
- 機微情報：健康状態に関する情報は最小限（自由記述は避け、選択肢中心）。
- 権利対応：開示・訂正・削除・利用停止の手続き整備。
- 医療免責：本サービスは医療行為ではない。緊急時は119。

---

### 13. 品質保証・受入基準（抜粋）
- 受入AT-01：警戒日に対象全件へ発呼され、通話成功率（接続）≥ 95%。
- AT-02：未応答3段階の連絡が時系列通りに実行・記録される。
- AT-03：「2/3」入力時、家族LINE到達≤10秒、発信ボタン機能。
- AT-04：管理画面で未応答が赤強調、手動再コールが成功しログに残る。
- AT-05：データ保持・マスキングが設定どおりに機能する。

---

### 14. 制約・前提・リスク
- 前提：本人が電話に出られる体制（受話器・携帯）を持つ。家族/近隣はLINE利⽤可能。
- 制約：外部API/電話事業者のSLAに依存。居住地メッシュ精度のばらつき。
- リスク：過剰通知による反発（→頻度制御/休止設定）、誤検知・誤着信（→ログと再発防止）。

---

### 15. 課金・運営（方向性）
- 家族直契約：月額¥300〜¥500/世帯（通話・SMS従量は別枠/上限設定）。
- 自治会契約：月額固定＋従量（世帯数×警戒日発呼回数）。スポンサー協賛スキーム可。
- コスト式：発呼分数×単価 + SMS通数×単価 + LINEプッシュ×単価 + インフラ少額

---

### 16. 付録：通知テンプレ（案）
- 電話IVR：「こちら、熱の見守りコールです。今日は暑さの警戒が出ています。エアコンは入っていますか？1大丈夫、2少ししんどい、3助けて。」
- 家族LINE（未応答）：「【未応答】◯◯さんに2回お電話しました。▷今すぐ電話 ▷『対応中』を記録 ▷近隣に声かけ依頼」
