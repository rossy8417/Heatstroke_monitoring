## 熱見守りボット（電話×LINE）タスク分解書（WBS） v1.0
- 作成日：2025-08-11（JST）
- 対象：MVP～正式版の実装・運用に必要な作業を網羅（要件定義書/システム仕様書準拠）
- 形式：エピック → ストリーム → タスク。所要は工数目安（人日）、順序は依存関係で管理。期日指定はしない。

---

### 0. 前提・体制・RACI
- 前提
  - 1～2名のフルスタック＋1名のPM/QA兼任を想定（外部協力：デザイナ1）。
  - 通信系はTwilio（音声/SMS）＋LINE Messaging API。
  - インフラは GCP（Cloud Run/Cloud Scheduler/Firestore/KMS/Cloud Storage）。
- 体制/RACI（略）
  - PM：全体計画、要求変更管理、対外窓口
  - BE：API/ルールエンジン/ジョブ/DB
  - FE：管理画面/デザイン反映
  - DevOps：CI/CD/監視/ログ/セキュリティ
  - Ops：導入・名簿整備・一次運用（パイロット時はPMが兼務）

---

### 1. エピック一覧
1. プロジェクト基盤・リポジトリ/CI（E-BASE）
2. ドメイン設計・データモデル・PII方針（E-DATA）
3. 暑さ判定ジョブ＆ルールエンジン（E-ALERT）
4. 音声IVR/発呼・DTMF・SMS（E-VOICE）
5. LINE Bot（家族/近隣通知・応答）（E-LINE）
6. 管理画面（当日アラート/世帯台帳/ログ/CSV）（E-ADMIN）
7. 監査ログ/可観測性/監視（E-OBS）
8. セキュリティ/同意/法務チェック（E-SEC）
9. QA・テスト自動化・受入（E-QA）
10. パイロット導入・運用手順（E-OPS）
11. コスト管理・スケーリング検証（E-COST）
12. ドキュメント/Runbook/教育（E-DOC）

---

### 2. WBS 詳細（タスクレベル）
表中の「所要」は初期目安（人日）。R=担当、D=成果物。依存は「E-◯◯:Txx」形式。

#### E-BASE：プロジェクト基盤・CI
- T01 GitHubリポ構成（mono-repo：/api, /web, /jobs, /infra） 0.5d
- T02 CI/CD雛形（GitHub Actions：lint/test/build/deploy） 1d
- T03 IaC雛形（Terraform or gcloud scripts） 1d
- T04 Secrets管理（GitHub OIDC→GCP、KMS） 0.5d
- T05 コーディング規約/lint/formatter/commit lint 0.5d
- T06 スタブ/モック環境（暑さAPI/発呼/LINE） 1d

#### E-DATA：ドメイン設計・データモデル
- T11 ERD確定（tenants/households/contacts/alerts/...） 0.5d
- T12 Firestoreコレクション/インデックス設計 0.5d
- T13 PII最小化・マスキング設計（90日ルール） 0.5d
- T14 監査ログのWORM構造/ハッシュ鎖仕様 0.5d

#### E-ALERT：暑さ判定ジョブ＆ルール
- T21 メッシュID変換（住所→grid）ユーティリティ 0.5d
- T22 暑さAPIクライアント（スタブ→実API置換） 1d
- T23 ルールエンジン（発火/時間枠/夜間停止） 1d
- T24 ジョブスケジューラ（毎時→キュー投入） 0.5d
- T25 単体/統合テスト（注意→警戒遷移） 0.5d

#### E-VOICE：音声IVR/発呼・SMS
- T31 Twilioアカウント/番号/発信権限設定 0.5d
- T32 発呼APIクライアント/レート制御 1d
- T33 IVRフロー（録音 or TTS、DTMF 1/2/3） 1d
- T34 Webhook受信（結果/DTMF/通話秒数保存） 0.5d
- T35 SMS送信・配達レシート受信 0.5d
- T36 発呼/未応答シーケンス実装 1d
- T37 フェイルオーバー設計（手動→自動） 0.5d

#### E-LINE：LINE Bot（家族/近隣）
- T41 LINE開発者登録/チャネル設定 0.5d
- T42 友だち紐付け/招待リンク/同意フロー 1d
- T43 Pushテンプレ（未応答/至急/対応中） 0.5d
- T44 Postback受信/状態遷移（対応中/完了） 0.5d
- T45 通知到達SLO計測（≤10秒目標） 0.5d

#### E-ADMIN：管理画面
- T51 認証（OIDC/Passwordless）/RBAC 1d
- T52 当日アラート一覧（未応答“赤”/手動再コール） 1.5d
- T53 世帯台帳CRUD/連絡順序設定 1d
- T54 通話ログ詳細/録音再生（任意） 0.5d
- T55 CSV出力（応答率/エスカ時間/集計） 0.5d
- T56 UX微調整（アクセシビリティ/大文字） 0.5d

#### E-OBS：監査・可観測性
- T61 構造化ログ/相関ID（alert_id/call_id） 0.5d
- T62 メトリクス（接続率/エスカ時間/失敗率） 0.5d
- T63 外形監視（テスト番号/LINE到達） 0.5d
- T64 監査ログWORM/改ざん検知 0.5d

#### E-SEC：セキュリティ/同意/法務
- T71 同意文書/プライバシーポリシー草案 0.5d
- T72 Firestoreルール/最小権限/行レベル 0.5d
- T73 KMS鍵/秘密管理/ローテ 0.5d
- T74 データ保持・マスキング実装（90日） 0.5d
- T75 医療免責・緊急ガイダンス明記 0.25d

#### E-QA：QA・テスト自動化
- T81 テスト戦略（単体/統合/外形/負荷） 0.5d
- T82 単体テスト（API/ルール/DB） 1d
- T83 統合テスト（未応答→家族→近隣） 1d
- T84 負荷試験（1,000 calls/min） 1d
- T85 受入テストシナリオ/記録 0.5d

#### E-OPS：パイロット導入・運用
- T91 名簿テンプレ/インポート手順 0.5d
- T92 運用Runbook（未応答対応/連絡網） 0.5d
- T93 障害時手順（手動運用/紙） 0.5d
- T94 パイロット合意書（同意/免責） 0.5d

#### E-COST：コスト管理・スケーリング
- T101 単価テーブル/見積もり式の実装 0.5d
- T102 通話時間/回数の実測ログ化 0.5d
- T103 アラート閾値/通知回数の最適化 1d

#### E-DOC：ドキュメント/教育
- T111 README（ローカル起動/スタブ） 0.5d
- T112 API仕様（OpenAPI/Swagger） 0.5d
- T113 管理者マニュアル/FAQ 0.5d
- T114 リリースノート/変更履歴 0.25d

- 概算合計工数（MVP）：約 20～24人日（1～2人月内で到達可）。
  - ※ 録音保存・多拠点・地図ヒートマップ等の拡張は別途＋5～10人日。

---

### 3. 品質ゲート（ステージング→本番の可否基準）
- ルール/IVR/エスカレーションのe2e成功率 100%（テストシナリオ全通過）
- LINE到達レイテンシ P95 ≤ 10秒、発呼キュー→着信 平均 ≤ 60秒
- 監査ログの改ざん検知パス、PIIマスキングの自動実行ログ残存
- 受入AT（要件定義書 §13）全項目OK

---

### 4. リスク & 対応タスク
| リスク | 影響 | 兆候 | 対応タスク |
|---|---|---|---|
| 通信プロバイダの一時障害 | 発呼不可/遅延 | 接続率低下/エラー増 | T37 フェイルオーバー、T63 外形監視 |
| 過通知による反発 | 解約率↑ | 未応答率↑/苦情 | T103 閾値最適化、通知停止UI |
| PII運用ミス | 法務リスク | 監査差分 | T72/T74/T73 ルール強化・KMS運用 |
| LINEブロック | 連絡漏れ | 既読低下 | T45 SLO監視、SMS代替導線 |

---

### 5. Issue テンプレ（GitHub）
```md
### 概要
（何を、なぜ）

### 受入基準（DoD）
- [ ] ◯◯
- [ ] ◯◯

### 実装メモ
- API/画面/DB変更点

### 依存関係
- E-◯◯:Txx

### リスク/懸念
```

---

### 6. 成果物一覧（納品/運用に必要なもの）
- ソース一式（`/api`, `/web`, `/jobs`, `/infra`）
- OpenAPI定義、ERD、セキュリティルール、Runbook、管理者マニュアル
- 監視ダッシュボード（主要メトリクス）
- パイロット同意書テンプレ、名簿CSVテンプレ
